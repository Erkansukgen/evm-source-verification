{"language":"Solidity","settings":{"libraries":{},"metadata":{"useLiteralContent":true},"optimizer":{"enabled":true,"runs":200},"remappings":[],"outputSelection":{"*":{"*":["*"],"":["*"]}}},"sources":{"browser/CollateralMaximizer.sol":{"content":"// SPDX-License-Identifier: MIT\r\npragma solidity 0.8.2;\r\n\r\ninterface cToken {\r\n    function underlying() external view returns (address);\r\n}\r\n\r\ninterface comptroller {\r\n    function getAllMarkets() external view returns (address[] memory);\r\n    function markets(address _market) external view returns (bool isListed, uint256 collateralFactorMantissa, bool isComped);\r\n}\r\n\r\ninterface aavecore {\r\n    struct ReserveConfigurationMap {\r\n        //bit 0-15: LTV\r\n        //bit 16-31: Liq. threshold\r\n        //bit 32-47: Liq. bonus\r\n        //bit 48-55: Decimals\r\n        //bit 56: Reserve is active\r\n        //bit 57: reserve is frozen\r\n        //bit 58: borrowing is enabled\r\n        //bit 59: stable rate borrowing enabled\r\n        //bit 60-63: reserved\r\n        //bit 64-79: reserve factor\r\n        uint256 data;\r\n    }\r\n    function getReserveConfiguration(address _market) external view returns (uint, uint, uint, bool);\r\n    function getConfiguration(address _market) external view returns (ReserveConfigurationMap memory);\r\n}\r\n\r\ncontract CollateralMaximizer {\r\n    address constant private _cream = address(0x3d5BC3c8d13dcB8bF317092d84783c2697AE9258);\r\n    address constant private _compound = address(0x3d9819210A31b4961b30EF54bE2aeD79B9c9Cd3B);\r\n    address constant private _aavev1 = address(0x3dfd23A6c5E8BbcFc9581d2E864a68feb6a076d3);\r\n    address constant private _aavev2 = address(0x7d2768dE32b0b80b7a3454c06BdAc94A69DDc7A9);\r\n    address constant private _ib = address(0xAB1c342C7bf5Ec5F02ADEA1c2270670bCa144CbB);\r\n    \r\n    uint256 constant LTV_MASK =                   0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0000; // prettier-ignore\r\n    uint256 constant LIQUIDATION_THRESHOLD_MASK = 0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0000FFFF; // prettier-ignore\r\n    uint256 constant LIQUIDATION_BONUS_MASK =     0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0000FFFFFFFF; // prettier-ignore\r\n    uint256 constant DECIMALS_MASK =              0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00FFFFFFFFFFFF; // prettier-ignore\r\n    uint256 constant ACTIVE_MASK =                0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFF; // prettier-ignore\r\n    uint256 constant FROZEN_MASK =                0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFDFFFFFFFFFFFFFF; // prettier-ignore\r\n    uint256 constant BORROWING_MASK =             0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFBFFFFFFFFFFFFFF; // prettier-ignore\r\n    uint256 constant STABLE_BORROWING_MASK =      0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFFFFFFFFF; // prettier-ignore\r\n    uint256 constant RESERVE_FACTOR_MASK =        0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0000FFFFFFFFFFFFFFFF; // prettier-ignore\r\n    \r\n    /// @dev For the LTV, the start bit is 0 (up to 15), hence no bitshifting is needed\r\n    uint256 constant LIQUIDATION_THRESHOLD_START_BIT_POSITION = 16;\r\n    uint256 constant LIQUIDATION_BONUS_START_BIT_POSITION = 32;\r\n    uint256 constant RESERVE_DECIMALS_START_BIT_POSITION = 48;\r\n    uint256 constant IS_ACTIVE_START_BIT_POSITION = 56;\r\n    uint256 constant IS_FROZEN_START_BIT_POSITION = 57;\r\n    uint256 constant BORROWING_ENABLED_START_BIT_POSITION = 58;\r\n    uint256 constant STABLE_BORROWING_ENABLED_START_BIT_POSITION = 59;\r\n    uint256 constant RESERVE_FACTOR_START_BIT_POSITION = 64;\r\n    \r\n    uint256 constant MAX_VALID_LTV = 65535;\r\n    uint256 constant MAX_VALID_LIQUIDATION_THRESHOLD = 65535;\r\n    uint256 constant MAX_VALID_LIQUIDATION_BONUS = 65535;\r\n    uint256 constant MAX_VALID_DECIMALS = 255;\r\n    uint256 constant MAX_VALID_RESERVE_FACTOR = 65535;\r\n    \r\n    function getParamsMemory(aavecore.ReserveConfigurationMap memory self) internal pure returns (uint256) { \r\n        return (self.data & ~LTV_MASK);\r\n    }\r\n    function lookupMarket(address _core, address _token) public view returns (address) {\r\n        address[] memory _list = comptroller(_core).getAllMarkets();\r\n        for (uint i = 0; i < _list.length; i++) {\r\n            if (cToken(_list[i]).underlying() == _token) {\r\n                return _list[i];\r\n            }\r\n        }\r\n        return address(0x0);\r\n    }\r\n    function lookupMarketCompound(address _token) external view returns (address) {\r\n        return lookupMarket(_compound, _token);\r\n    }\r\n    function lookupMarketCream(address _token) external view returns (address) {\r\n        return lookupMarket(_cream, _token);\r\n    }\r\n    function lookupMarketIB(address _token) external view returns (address) {\r\n        return lookupMarket(_ib, _token);\r\n    }\r\n    function getLTVCream(address _token) public view returns (uint cream) {\r\n        (,cream,) = comptroller(_cream).markets(lookupMarket(_cream, _token));\r\n        cream = cream / 1e16;\r\n    }\r\n    function getLTVCompound(address _token) public view returns (uint compound) {\r\n        (,compound,) = comptroller(_compound).markets(lookupMarket(_compound, _token));\r\n        compound = compound / 1e16;\r\n    }\r\n    function getLTVIB(address _token) public view returns (uint ib) {\r\n        (,ib,) = comptroller(_ib).markets(lookupMarket(_ib, _token));\r\n        ib = ib / 1e16;\r\n    }\r\n    function getLTVAaveV1(address _token) public view returns (uint aavev1) {\r\n        (,aavev1,,) = aavecore(_aavev1).getReserveConfiguration(_token);\r\n    }\r\n    function getLTVAaveV2(address _token) public view returns (uint aavev2) {\r\n        (aavev2) = getParamsMemory(aavecore(_aavev2).getConfiguration(_token));\r\n    }\r\n    function getLTV(address _token) public view returns (uint cream, uint compound, uint ib, uint aavev1, uint aavev2) {\r\n        cream = getLTVCream(_token);\r\n        compound = getLTVCompound(_token);\r\n        ib = getLTVIB(_token);\r\n        aavev1 = getLTVAaveV1(_token);\r\n        aavev2 = getLTVAaveV2(_token);\r\n    }\r\n}"}}}