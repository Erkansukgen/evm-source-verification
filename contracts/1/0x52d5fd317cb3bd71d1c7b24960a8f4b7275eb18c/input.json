{"language":"Solidity","settings":{"libraries":{},"metadata":{"useLiteralContent":true},"optimizer":{"enabled":true,"runs":200},"remappings":[],"outputSelection":{"*":{"*":["*"],"":["*"]}}},"sources":{"Updater.sol":{"content":"// File: contracts/updater/interfaces/IFreeFromUpTo.sol\r\n\r\npragma solidity ^0.6.12;\r\n\r\ninterface IFreeFromUpTo {\r\n    function freeFromUpTo(address from, uint256 value) external returns (uint256 freed);\r\n}\r\n\r\n// File: contracts/updater/BurnChi.sol\r\n\r\npragma solidity 0.6.12;\r\n\r\ncontract BurnChi {\r\n    IFreeFromUpTo private constant chi = IFreeFromUpTo(0x0000000000004946c0e9F43F4Dee607b0eF1fA1c);\r\n\r\n    modifier discountCHI(bool _useChi) {\r\n        if(_useChi) {\r\n            uint256 gasStart = gasleft();\r\n            _;\r\n            uint256 gasSpent = 21000 + gasStart - gasleft() + 16 * msg.data.length;\r\n            chi.freeFromUpTo(msg.sender, (gasSpent + 14154) / 41130);\r\n        } else {\r\n            _;\r\n        }\r\n    }\r\n}\r\n\r\n// File: contracts/updater/interfaces/ITokenManager.sol\r\n\r\npragma solidity ^0.6.12;\r\n\r\ninterface ITokenManager {\r\n  function updateRewardParams(address payable userAddr) external returns (bool);\r\n}\r\n\r\n// File: contracts/updater/interfaces/IObserver.sol\r\n\r\npragma solidity ^0.6.12;\r\n\r\ninterface IObserver {\r\n  function updateChainMarketInfo(uint256 _idx, uint256 chainDeposit, uint256 chainBorrow) external returns (bool);\r\n}\r\n\r\n// File: contracts/updater/Updater.sol\r\n\r\npragma solidity ^0.6.12;\r\n\r\ncontract Updater is BurnChi {\r\n  address public owner;\r\n\r\n  ITokenManager public manager;\r\n  IObserver public observer;\r\n\r\n  modifier onlyOwner {\r\n\t\trequire(msg.sender == owner, \"onlyOwner\");\r\n\t\t_;\r\n\t}\r\n\r\n  constructor(address managerAddress, address observerAddress) public {\r\n    owner = msg.sender;\r\n\r\n    manager = ITokenManager(managerAddress);\r\n    observer = IObserver(observerAddress);\r\n  }\r\n\r\n  function setManager(address managerAddress) public onlyOwner returns (bool) {\r\n    manager = ITokenManager(managerAddress);\r\n    return true;\r\n  }\r\n\r\n  function setObserver(address observerAddress) public onlyOwner returns (bool) {\r\n    observer = IObserver(observerAddress);\r\n    return true;\r\n  }\r\n\r\n  function syncReward(address payable rewerder, uint256 _idx, uint256 chainDeposit, uint256 chainBorrow, bool _useChi) external onlyOwner discountCHI(_useChi) returns (bool) {\r\n    _updateChainMarketInfo(_idx, chainDeposit, chainBorrow);\r\n    _updateRewardParams(rewerder);\r\n    return true;\r\n  }\r\n\r\n  function updateRewardParams(address payable rewerder, bool _useChi) external onlyOwner discountCHI(_useChi) returns (bool) {\r\n    return _updateRewardParams(rewerder);\r\n  }\r\n\r\n  function _updateRewardParams(address payable rewerder) internal returns (bool) {\r\n    return manager.updateRewardParams(rewerder);\r\n  }\r\n\r\n  function updateChainMarketInfo(uint256 _idx, uint256 chainDeposit, uint256 chainBorrow, bool _useChi) external onlyOwner discountCHI(_useChi) returns (bool) {\r\n    return _updateChainMarketInfo(_idx, chainDeposit, chainBorrow);\r\n  }\r\n\r\n  function _updateChainMarketInfo(uint256 _idx, uint256 chainDeposit, uint256 chainBorrow) internal returns (bool) {\r\n    return observer.updateChainMarketInfo(_idx, chainDeposit, chainBorrow);\r\n  }\r\n}"}}}