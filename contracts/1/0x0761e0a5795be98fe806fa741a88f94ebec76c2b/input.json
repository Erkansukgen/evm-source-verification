{
  "language": "Solidity",
  "settings": {
    "libraries": {},
    "metadata": {
      "useLiteralContent": true
    },
    "optimizer": {
      "enabled": true,
      "runs": 200
    },
    "remappings": [],
    "outputSelection": {
      "*": {
        "*": [
          "*"
        ],
        "": [
          "*"
        ]
      }
    }
  },
  "sources": {
    "Messaging.sol": {
      "content": "// SPDX-License-Identifier: MIT\r\n\r\npragma solidity ^0.8.0;\r\n\r\ncontract Messaging {\r\n    uint256 public threadCount = 0;\r\n    mapping(address => string) private pubEncKeys; // mapping of address to public encryption key https://docs.metamask.io/guide/rpc-api.html#eth-getencryptionpublickey\r\n\r\n    event MessageSent (\r\n        address receiver,\r\n        string uri,\r\n        uint256 timestamp,\r\n        address sender,\r\n        uint256 thread_id\r\n    );\r\n\r\n    event ThreadCreated (\r\n        address receiver,\r\n        address sender,\r\n        uint256 thread_id,\r\n        uint256 timestamp,\r\n        string _sender_key,\r\n        string _receiver_key,\r\n        bool _encrypted\r\n    );\r\n\r\n    function getPubEncKeys(address receiver) public view returns(string memory sender_key, string memory receiver_key) {\r\n\r\n        require(bytes(pubEncKeys[msg.sender]).length != 0, \"Sender isn't registered on Dakiya\");\r\n\r\n        if (bytes(pubEncKeys[msg.sender]).length != 0) {\r\n            sender_key = pubEncKeys[msg.sender];\r\n        }\r\n        if (bytes(pubEncKeys[receiver]).length != 0) {\r\n            receiver_key = pubEncKeys[receiver];\r\n        }\r\n        return (sender_key, receiver_key);\r\n    }\r\n\r\n    function checkUserRegistration() public view returns(bool) {\r\n        return bytes(pubEncKeys[msg.sender]).length != 0;\r\n    }\r\n\r\n    function setPubEncKey(string memory encKey) public {\r\n        pubEncKeys[msg.sender] = encKey;\r\n    }\r\n\r\n    function sendMessage(\r\n        uint256 _thread_id,\r\n        string memory _uri,\r\n        address _receiver,\r\n        string memory _sender_key,\r\n        string memory _receiver_key,\r\n        bool encrypted\r\n    ) public {\r\n        if (_thread_id == 0) {\r\n            emit ThreadCreated(\r\n                _receiver,\r\n                msg.sender,\r\n                threadCount,\r\n                block.timestamp,\r\n                _sender_key,\r\n                _receiver_key,\r\n                encrypted\r\n            );\r\n\r\n            emit MessageSent(_receiver, _uri, block.timestamp, msg.sender, threadCount);\r\n\r\n            threadCount++;\r\n\r\n        } else {\r\n            emit MessageSent(_receiver, _uri, block.timestamp, msg.sender, _thread_id);\r\n        }\r\n    }\r\n}"
    }
  }
}