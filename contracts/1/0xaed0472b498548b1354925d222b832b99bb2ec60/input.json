{"language":"Solidity","settings":{"libraries":{},"metadata":{"useLiteralContent":true},"optimizer":{"enabled":true,"runs":200},"remappings":[],"outputSelection":{"*":{"*":["*"],"":["*"]}}},"sources":{"SwapTokens.sol":{"content":"// SPDX-License-Identifier: GPL-3.0-or-later\r\n\r\npragma solidity ^0.8.6;\r\n\r\n// helper methods for interacting with ERC20 tokens\r\nlibrary TransferHelper {\r\n    function safeTransfer(address token, address to, uint value) internal {\r\n        // bytes4(keccak256(bytes('transfer(address,uint256)')));\r\n        (bool success, bytes memory data) = token.call(abi.encodeWithSelector(0xa9059cbb, to, value));\r\n        require(success && (data.length == 0 || abi.decode(data, (bool))), 'TransferHelper: TRANSFER_FAILED');\r\n    }\r\n\r\n    function safeTransferFrom(address token, address from, address to, uint value) internal {\r\n        // bytes4(keccak256(bytes('transferFrom(address,address,uint256)')));\r\n        (bool success, bytes memory data) = token.call(abi.encodeWithSelector(0x23b872dd, from, to, value));\r\n        require(success && (data.length == 0 || abi.decode(data, (bool))), 'TransferHelper: TRANSFER_FROM_FAILED');\r\n    }\r\n}\r\n\r\ncontract SwapTokens {\r\n    address public immutable srcToken;\r\n    address public immutable dstToken;\r\n\r\n    // eg. if swap rate 1:100 (src:dst), then numeratorOfRate=100, denominatorOfRate=1\r\n    // eg. if swap rate 2:3 (src:dst), then numeratorOfRate=3, denominatorOfRate=2\r\n    uint256 public immutable numeratorOfRate;\r\n    uint256 public immutable denominatorOfRate;\r\n\r\n    uint256 public latestWithdrawRequestTime;\r\n    uint256 public latestWithdrawRequestAmount;\r\n    uint256 public constant minWithdrawApprovalInterval = 2 days;\r\n\r\n    address public owner;\r\n    modifier onlyOwner() {\r\n        require(msg.sender == owner, \"only owner\");\r\n        _;\r\n    }\r\n\r\n    event Swapped(address indexed sender, uint256 indexed srcAmount, uint256 indexed dstAmount);\r\n\r\n    constructor(address _srcToken, address _dstToken, uint256 _numeratorOfRate, uint256 _denominatorOfRate) {\r\n        srcToken = _srcToken;\r\n        dstToken = _dstToken;\r\n        numeratorOfRate = _numeratorOfRate;\r\n        denominatorOfRate = _denominatorOfRate;\r\n        owner = msg.sender;\r\n    }\r\n\r\n    function transferOwnership(address newOwner) external onlyOwner {\r\n        require(newOwner != address(0), \"the new owner is the zero address\");\r\n        owner = newOwner;\r\n    }\r\n\r\n    /// @dev swap with `srcAmount` of `srcToken` to get `dstToken`.\r\n    /// Returns swap result of `dstAmount` of `dstToken`.\r\n    /// Requirements:\r\n    ///   - `msg.sender` must have approved at least `srcAmount` `srcToken` to `address(this)`.\r\n    ///   - `address(this)` must have at least `dstAmount` `dstToken`.\r\n    function swap(uint256 srcAmount) external returns (uint256 dstAmount) {\r\n        dstAmount = srcAmount * numeratorOfRate / denominatorOfRate;\r\n        TransferHelper.safeTransferFrom(srcToken, msg.sender, address(this), srcAmount);\r\n        TransferHelper.safeTransfer(dstToken, msg.sender, dstAmount);\r\n        emit Swapped(msg.sender, srcAmount, dstAmount);\r\n        return dstAmount;\r\n    }\r\n\r\n    function withdrawRequest(uint256 amount) external onlyOwner {\r\n        if (amount > 0) {\r\n            latestWithdrawRequestTime = block.timestamp;\r\n            latestWithdrawRequestAmount = amount;\r\n        } else {\r\n            latestWithdrawRequestTime = 0;\r\n            latestWithdrawRequestAmount = 0;\r\n        }\r\n    }\r\n\r\n    function withdraw() external onlyOwner {\r\n        require(\r\n            latestWithdrawRequestTime > 0 && latestWithdrawRequestAmount > 0,\r\n            \"please do withdraw request firstly\"\r\n        );\r\n        require(\r\n            latestWithdrawRequestTime + minWithdrawApprovalInterval < block.timestamp,\r\n            \"the minimum withdraw approval interval is not satisfied\"\r\n        );\r\n        uint256 amount = latestWithdrawRequestAmount;\r\n        latestWithdrawRequestTime = 0;\r\n        latestWithdrawRequestAmount = 0;\r\n        TransferHelper.safeTransfer(dstToken, msg.sender, amount);\r\n    }\r\n}"}}}